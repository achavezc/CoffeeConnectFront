<form class="needs-validation" [formGroup]="liquidacionProcesoFormEdit">
  <section id="tooltip-validation">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header" style="margin-bottom: 2rem;">
            <div class="row">
              <div class="col-12 col-md-8">
                <div class="card-title-empresa">{{vSessionUser.Result.Data.RazonSocialEmpresa}}</div>
                <div class="card-subtitle-empresa">{{vSessionUser.Result.Data.DireccionEmpresa}}</div>
                <div class="card-subtitle-empresa">RUC: {{vSessionUser.Result.Data.RucEmpresa}}
                </div>
              </div>
              <div class="col-12 col-md-4">

                <div class="form-row">

                  <div class="col-md-6 form-group" *ngIf="esEdit">
                    <label class="card-forms" for="users-edit-name">N° LIQUIDACION DE PROCESO</label>
                  </div>
                  <div class="col-md-6 form-group">
                    <label class="card-forms" for="users-edit-username" style="font-weight: bold;">{{numero}}</label>
                  </div>
                </div>
                <div class="form-row">

                  <div class="col-md-6 form-group" *ngIf="esEdit">
                    <label class="card-forms" for="users-edit-email">FECHA</label>
                  </div>
                  <div class="col-md-6 form-group">
                    <label class="card-forms" for="users-edit-username"
                      style="font-weight: bold;">{{fechaRegistro}}</label>
                  </div>
                </div>

              </div>

            </div>


            <div class="row" style="margin-right: 6rem; margin-left: 6rem; margin-top: 1rem;">
              <div class="col-12 col-md-5">
                

                <label for="basicInput">Numero de Orden de Proceso</label>
                <input type="text" class="form-control" id="basicInput" formControlName="numOrdenProceso"  [ngClass]="{ 'is-invalid': submittedEdit && fns.numOrdenProceso.invalid, 'is-valid': submittedEdit && !fns.numOrdenProceso.invalid }" disabled>
                <small class="form-text text-muted danger" *ngIf="fns.numOrdenProceso.errors?.required">Seleccione Orden de Proceso</small>
                <label for="fechaFin" >Fecha de Inicio Proceso</label>
                <input type="text" class="form-control" id="basicInput" formControlName="fechaInicioProceso" disabled>
                <label for="basicInput">Ruc</label>
                <input type="text" class="form-control" id="basicInput" formControlName="ruc" disabled>

                <label for="basicInput">Materia Prima</label>
                <input type="text" class="form-control" id="basicInput" formControlName="producto" disabled>
                <label for="basicInput">Producto Terminado</label>
                <input type="text" class="form-control" id="basicInput" formControlName="productoTerminado" disabled>

                <!-- <label for="basicInput">Estado de Humedad</label>
                <input type="text" class="form-control" id="basicInput" formControlName="subproducto" disabled> -->

              
                                 


              </div>
              <div class="col-12 col-md-2" style="padding-left: 0cm;">
                <ng-template #modalOrdenProceso let-c="close" let-d="dismiss">
                  <div class="modal-header" style="text-align: center;">

                    <h4 class="modal-title" style="font-size: 1rem;">Bandeja de Orden de Proceso</h4>
                    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <app-ordenproceso-list [popUp]="popUp" (seleccionarEvent)="agregarOrdenProceso($event)">
                    </app-ordenproceso-list>
                  </div>

                </ng-template>
                <button type="button" (click)="openModal(modalOrdenProceso)" class="btn btn-default"
                  style="margin-top: 1.5rem;">
                  <i class="fa fa-search"></i>
                </button>
              </div>
              <div class="col-12 col-md-5">

                <label for="basicInput">Tipo de Proceso</label>
                <input type="text" class="form-control" id="basicInput" formControlName="tipoProceso" disabled
                  class="form-control"
                  [ngClass]="{ 'is-invalid': submittedEdit && fns.tipoProceso.invalid, 'is-valid': submittedEdit && !fns.tipoProceso.invalid }">
                <small class="form-text text-muted danger" *ngIf="fns.tipoProceso.errors?.required">Ingrese
                  Tipo de Proceso</small>
                  <label for="fechaFin" >Fecha de Termino Proceso</label>
                  <!-- <input type="text" class="form-control" id="basicInput" formControlName="fechaFinProceso" disabled> -->

                  <input type="date" class="form-control" formControlName="fechaFinProceso" id="validationTooltip10"
                      name="fechaFinProceso" placeholder="date" date
                      [ngClass]="{ 'is-invalid': submittedEdit && fedit.fechaFinProceso.invalid, 'is-valid': submittedEdit && !fedit.fechaFinProceso.invalid }" />
                 



                <label for="basicInput"></label>
                <input type="text" class="form-control" id="basicInput" formControlName="razonSocial" disabled>

                
                <label for="basicInput">Certificadora</label>
                <input type="text" class="form-control" id="basicInput" formControlName="certificadora" disabled>

                <label for="basicInput">Certificación</label>
                <input type="text" class="form-control" id="basicInput" formControlName="certificacion" disabled>

              </div>
            </div>

            <!--           </form> -->
          </div>
        </div>
      </div>
    </div>

  </section>
  <section class="users-edit">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">

              <div class="row">
                <div class="col-md-5">
                  <ngx-datatable #tblMateriaPrima class="bootstrap core-bootstrap" [columnMode]="'force'"
                    [headerHeight]="50" [footerHeight]="50" rowHeight="auto" [limit]="limitRef"
                    [rows]="rowsMateriaPrima" [summaryRow]="true" [summaryPosition]="'bottom'">

                    <ngx-datatable-column name="Nota de Ingreso" prop="Descripcion" width="50">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Sacos" prop="Cantidad" width="50">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Humedad %" prop="PorcentajeHumedad" width="50" [summaryFunc]="emptySumm">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Kilos Netos" prop="KilosNetos" width="50" [summaryTemplate]="kilosNetosNotas">
                    </ngx-datatable-column>
                  </ngx-datatable>
                  <ng-template #kilosNetosNotas let-row="row" let-name="value" ngx-datatable-cell-template>
                    <div>
                    {{ sumKilosNetos }}
                    </div>
                  </ng-template>

                </div>

                <div class="col-md-7">
                  <ngx-datatable #tblResultProceso class="bootstrap core-bootstrap" [columnMode]="'force'" 
                    [headerHeight]="50" [footerHeight]="50" rowHeight="auto" [limit]="limitRef"
                    [rows]="rowsResultProceso" [scrollbarH]="false" [summaryRow]="true" [summaryPosition]="'bottom'" *ngIf="!EsHumedo">
                    <ngx-datatable-column name="Referencia" prop="Label" width="100">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Sacos" prop="CantidadSacos" width="45" [formGroup]="formGroupSacos"
                      [summaryTemplate]="totalSacos">
                     <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput"
                          [formControlName]="row.Codigo+'%sacos'" (input)="calcularKilosNetos()">
                      </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Kg. N" prop="KGN" width="45" [formGroup]="formGroupKg"
                      [summaryTemplate]="totalKg">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%Kg'" (input)="calcularKilosNetos()">

                      </ng-template>
                    </ngx-datatable-column>           
                     <!-- <ngx-datatable-column name="Tipo" prop="TipoId"  width="350" [formGroup]="formGroupTipoEmpaque">
                      <ng-template ngx-datatable-cell-template let-row="row" let-TipoId="value" 
                          let-rowIndex="rowIndex">
                              <ng-select [items]="listaDetalleTipoEmpaque"  width="300"   
                                  class="form-control" bindLabel="Label" bindValue="Codigo" placeholder="Tipo Empaque"  id="validationTooltip12" [formControlName]="row.Codigo+'%tipoempaque'"
                                  [(ngModel)]="selectedDetalleTipoEmpaque[row.Codigo+'%selectedtipoempaque']">
                              </ng-select>
                      </ng-template>
                    </ngx-datatable-column> 
                  <ngx-datatable-column name="Empaque" prop="EmpaqueId"  width="300"  [formGroup]="formGroupEmpaque">
                    <ng-template ngx-datatable-cell-template let-row="row" let-EmpaqueId="value" 
                        let-rowIndex="rowIndex">                      
                        <ng-select [items]="listaDetalleEmpaque"  width="200"   
                            class="form-control" bindLabel="Label" bindValue="Codigo" placeholder="Empaque"  id="validationTooltip12" [formControlName]="row.Codigo+'%empaque'"
                            [(ngModel)]="selectedDetalleEmpaque[row.Codigo+'%selectedempaque']">
                        </ng-select>                    
                        </ng-template>
                </ngx-datatable-column> -->
                <ngx-datatable-column name="Kilos Netos" prop="KilosNetos" width="45"
                  [formGroup]="formGroupKilosNetos" [summaryTemplate]="totalKilosNetos">
                  <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                    <input type="number" class="form-control" id="basicInput"
                      [formControlName]="row.Codigo+'%kilosNetos'"  disabled>
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="%" prop="Porcentaje" width="45" [formGroup]="formGroupPorcentaje"
                  [summaryTemplate]="totalPorcentaje">
                  <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                    <input type="number" class="form-control" id="basicInput"
                      [formControlName]="row.Codigo+'%porcentaje'" disabled>
                  </ng-template>
                </ngx-datatable-column>
                <ngx-datatable-column name="Kilos Netos / 46" prop="QQKg" width="60" [formGroup]="formGroupQqkg"
                  [summaryTemplate]="totalQqkg" disabled>
                  <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                    <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%qqkg'"
                      disabled>
                  </ng-template>
                </ngx-datatable-column>
                  </ngx-datatable>


                  <ng-template #totalSacos let-row="row" let-name="value" ngx-datatable-cell-template>
                    <input class="form-control" formControlName="totalSacos">
                  </ng-template>
                  <ng-template #totalKg let-row="row" let-name="value" ngx-datatable-cell-template>
                    <input class="form-control" formControlName="totalKg">
                  </ng-template>
                  <ng-template #totalKilosNetos let-row="row" let-name="value" ngx-datatable-cell-template>
                    <input class="form-control" formControlName="totalKilosNetos">
                  </ng-template>
                  <ng-template #totalPorcentaje let-row="row" let-name="value" ngx-datatable-cell-template>
                    <input class="form-control" formControlName="totalPorcentaje">
                  </ng-template>
                  <ng-template #totalQqkg let-row="row" let-name="value" ngx-datatable-cell-template>
                    <input class="form-control" formControlName="totalQqkg">
                  </ng-template>



                  <ngx-datatable #tblResultProcesoHumedo class="bootstrap core-bootstrap" [columnMode]="'force'" 
                    [headerHeight]="50" [footerHeight]="50" rowHeight="auto" [limit]="limitRef"
                    [rows]="rowsResultProceso" [scrollbarH]="false" [summaryRow]="true" [summaryPosition]="'bottom'" *ngIf="EsHumedo">
                    <ngx-datatable-column name="Referencia" prop="Label" width="80">
                    </ngx-datatable-column>
                    <!-- <ngx-datatable-column name="Sacos" prop="CantidadSacos" width="100">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Kilos Brutos" prop="KilosBrutos" width="100">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Kilos Netos" prop="KilosNetos" width="100">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="HO2%" prop="KGN" width="100">
                    </ngx-datatable-column> -->
                   
                    
                    

                    <ngx-datatable-column name="Sacos" prop="CantidadSacos" width="20" [formGroup]="formGroupSacosHumedo"
                      [summaryTemplate]="totalSacosHumedo">
                     <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput"
                          [formControlName]="row.Codigo+'%sacosHumedo'"  >
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="Kilos Brutos" prop="KilosBrutos" width="20" [formGroup]="formGroupKilosBrutosHumedo"
                      [summaryTemplate]="totalKilosBrutosHumedo">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%kilosBrutosHumedo'"  (input)="calcularKilosNetosHumedo()">
                      </ng-template>
                    </ngx-datatable-column>


                    <ngx-datatable-column name="Kilos Netos" prop="KilosNetos" width="20" [formGroup]="formGroupKilosNetosHumedo"
                      [summaryTemplate]="totalKilosNetosHumedo">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%kilosNetosHumedo'" disabled="true">
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="H2O %" prop="KGN" width="20" [formGroup]="formGroupH2OHumedo"
                      [summaryTemplate]="totalH2OHumedo">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%h2OHumedo'" >
                      </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column name="Merma (KN)" prop="Tara" width="20" [formGroup]="formGroupMermaKilosNetosHumedo"
                      [summaryTemplate]="totalMermaKilosNetosHumedo">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%mermakilosNetosHumedo'" disabled="true">
                      </ng-template>
                    </ngx-datatable-column>

                    

                    <ngx-datatable-column name="Merma (%H)" prop="Porcentaje" width="20" [formGroup]="formGroupMermaPorcentajeHumedo"
                      [summaryTemplate]="totalMermaPorcentajeHumedo">
                      <ng-template let-row="row" let-name="value" let-rowIndex="rowIndex" ngx-datatable-cell-template>
                        <input type="number" class="form-control" id="basicInput" [formControlName]="row.Codigo+'%mermaPorcentajeHumedo'" disabled="true">
                      </ng-template>
                    </ngx-datatable-column>





                    

                    <!-- <ngx-datatable-column name="Kilos Netos" prop="KilosNetos" width="100">
                    </ngx-datatable-column> -->

                   <!--  <ngx-datatable-column name="Merma (KN)" prop="Tara" width="100">
                    </ngx-datatable-column>
                    <ngx-datatable-column name="Merma (%H)" prop="Porcentaje" width="100">
                    </ngx-datatable-column> -->
                    
                  </ngx-datatable>


                </div>
              </div>
              <div class="row">
                <div class="col-5">
                  <label for="basicInput" style="font-size: 0.7rem;">Observaciones</label>
                  <div class="position-relative has-icon-left">
                    <textarea id="bordered-form-6" rows="4" class="form-control" maxlength="1000" name="notes"
                      formControlName="observacion">
                          </textarea>
                    <div class="form-control-position">
                      <i class="ft-file"></i>
                    </div>
                  </div>
                </div>
                <div class="col-7" *ngIf="!EsHumedo">
                  <label for="basicInput">Envases con su Productos</label>
                  <input type="text" class="form-control" id="basicInput" formControlName="envases" 
                  [ngClass]="{ 'is-invalid': submittedEdit && fns.envases.invalid, 'is-valid': submittedEdit && !fns.envases.invalid }">
                  <label for="basicInput">Trabajos Realizados</label>
                  <input type="text" class="form-control" id="basicInput" formControlName="trabajos"
                  [ngClass]="{ 'is-invalid': submittedEdit && fns.trabajos.invalid, 'is-valid': submittedEdit && !fns.trabajos.invalid }">
                  <label for="basicInput">Numero de Defectos</label>
                  <input type="text" class="form-control" id="basicInput" formControlName="numDefectos"
                  [ngClass]="{ 'is-invalid': submittedEdit && fns.numDefectos.invalid, 'is-valid': submittedEdit && !fns.numDefectos.invalid }">
                </div>
              </div>
              <div *ngIf="esEdit" class="row" style="margin-top: 2rem;">
                <div class="col-8 d-flex flex-sm-row flex-column">
                  <label class="col-md-5 col-form-label card-text" for="horizontal-form-1">Responsable</label>
                  <label class="col-md-7 col-form-label card-text" style="font-weight: bold;"
                    for="horizontal-form-1">{{responsable}}</label>
                </div>
                <div class="col-8 d-flex flex-sm-row flex-column">
                  <label class="col-md-5 col-form-label card-text" for="horizontal-form-1">Fecha Liquidacion de
                    Proceso</label>
                  <label class="col-md-7 col-form-label card-text" style="font-weight: bold;"
                    for="horizontal-form-1">{{fechaRegistro}}</label>
                </div>

              </div>
              <div class="col-md-10">
                <small class="form-text text-muted danger"
                  *ngIf="errorGeneral.isError">{{errorGeneral.errorMessage}}</small>
              </div>
              <div class="card-footer text-right" style="margin-top: 2rem;">
               
                <button type="submit" class="btn btn-primary mb-2 mb-sm-0 mr-sm-2"
                  (click)="ImprimirLiquidacionProceso()" [disabled]="!id || id <= 0">Imprimir</button>
                <button type="submit" class="btn btn-primary mb-2 mb-sm-0 mr-sm-2" (click)="guardar()" [disabled]="readonly==true">Guardar</button>
                <button type="submit"class="btn btn-danger ml-1"
                  (click)="cancelar()">Cancelar</button>
              </div>
              <!--   </ng-template>
                  </li>
                </ul>-->


            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="d-flex justify-content-between align-items-center">
    <ngx-spinner></ngx-spinner>
  </div>

</form>