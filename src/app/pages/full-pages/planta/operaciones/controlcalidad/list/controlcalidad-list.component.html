<div class="row" *ngIf="!popUp">
    <div class="col-12">
      <div class="content-header">Control de Calidad</div>
    </div>
  </div>
  
  
  <section id="tooltip-validation">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <form class="needs-validation" [formGroup]="consultaControlCalidadPlantaForm">
                <div class="form-row">
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip04">Nro Nota de Ingreso</label>
                    <input type="text" minlength="5" maxlength="20" formControlName="notaIngreso" class="form-control"
                      id="validationTooltip04" placeholder="Nro Nota de Ingreso"
                      [ngClass]="{ 'is-invalid': submitted && f.notaIngreso.invalid, 'is-valid': submitted &&  !f.notaIngreso.invalid }">
                    <small class="form-text text-muted danger" *ngIf="f.notaIngreso.errors?.minlength">Ingrese 5 a 20
                      letras</small>
                    <small class="form-text text-muted danger" *ngIf="f.notaIngreso.errors?.maxlength">Ingrese 5 a 20
                      letras</small>
                    <small class="form-text text-muted danger" *ngIf="f.notaIngreso.errors?.pattern">Solo letras y
                      números</small>
                  </div>
                  
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip08">Nro Guia Remision</label>
                    <input type="text" minlength="8" maxlength="20" formControlName="numeroGuiaRemision"
                      class="form-control" id="validationTooltip08" placeholder="Nro Guia Remision"
                      [ngClass]="{ 'is-invalid': submitted && f.numeroGuiaRemision.invalid, 'is-valid': submitted && !f.numeroGuiaRemision.invalid }">
                    <small class="form-text text-muted danger" *ngIf="f.numeroGuiaRemision.errors?.minlength">Ingrese 8 a
                      20
                      letras</small>
                    <small class="form-text text-muted danger" *ngIf="f.numeroGuiaRemision.errors?.maxlength">Ingrese 8 a
                      20
                      letras</small>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip06">Organizacion</label>
                    <input type="text" minlength="5" maxlength="100" formControlName="ruc" class="form-control"
                      id="validationTooltip06" placeholder="Ruc"
                      [ngClass]="{ 'is-invalid': submitted && f.ruc.invalid, 'is-valid': submitted && !f.ruc.invalid }">
                    <small class="form-text text-muted danger" *ngIf="f.ruc.errors?.minlength">Ingrese 5 a 20
                      letras</small>
                    <small class="form-text text-muted danger" *ngIf="f.ruc.errors?.maxlength">Ingrese 5 a 20
                      letras</small>
                  </div>
                </div>
                <div class="form-row">
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip04">Fecha Inicio</label>
                    <input type="date" class="form-control" formControlName="fechaInicio" id="validationTooltip07"
                      name="fechaInicio" placeholder="date" date
                      [ngClass]="{ 'is-invalid': submitted && f.fechaInicio.invalid, 'is-valid': submitted && !f.fechaInicio.invalid }"
                      (blur)="compareFechas()" />
                    <small class="form-text text-muted danger"
                      *ngIf="errorFecha.isError">{{errorFecha.errorMessage}}</small>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip10">Fecha Fin</label>
                    <input type="date" class="form-control" formControlName="fechaFin" id="validationTooltip10"
                      name="fechaFin" placeholder="date" date
                      [ngClass]="{ 'is-invalid': submitted && f.fechaFin.invalid, 'is-valid': submitted && !f.fechaFin.invalid }"
                      (blur)="compareTwoDates()" />
                    <small class="form-text text-muted danger" *ngIf="error.isError">{{error.errorMessage}}</small>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip09">Razon Social Organizacion</label>
                    <input type="text" minlength="5" maxlength="100" formControlName="organizacion" class="form-control"
                      id="validationTooltip06" placeholder="Ruc"
                      [ngClass]="{ 'is-invalid': submitted && f.organizacion.invalid, 'is-valid': submitted && !f.organizacion.invalid }">
                  </div>
                </div>
                <div class="form-row">
                 
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip04">Fecha Guia Remision Inicio</label>
                    <input type="date" class="form-control" formControlName="fechaGuiaRemisionInicio" id="validationTooltip07"
                      name="fechaGuiaRemisionInicio" placeholder="date" date
                      [ngClass]="{ 'is-invalid': submitted && f.fechaGuiaRemisionInicio.invalid, 'is-valid': submitted && !f.fechaGuiaRemisionInicio.invalid }"
                      (blur)="compareFechas()" />
                    <small class="form-text text-muted danger"
                      *ngIf="errorFecha.isError">{{errorFecha.errorMessage}}</small>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip10">Fecha Guia Remision Fin</label>
                    <input type="date" class="form-control" formControlName="fechaGuiaRemisionFin" id="validationTooltip10"
                      name="fechaGuiaRemisionFin" placeholder="date" date
                      [ngClass]="{ 'is-invalid': submitted && f.fechaGuiaRemisionFin.invalid, 'is-valid': submitted && !f.fechaGuiaRemisionFin.invalid }"
                      (blur)="compareTwoDates()" />
                    <small class="form-text text-muted danger" *ngIf="error.isError">{{error.errorMessage}}</small>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip12">Tipo Producto</label>
                    <ng-select [items]="listaProducto" formControlName="tipoProducto" class="form-control"
                      bindLabel="Label" bindValue="Codigo" id="validationTooltip12" placeholder="Tipo Producto"
                      [ngClass]="{ 'is-invalid': submitted && f.tipoProducto.invalid, 'is-valid': submitted && !f.tipoProducto.invalid }"
                      (change)="changeSubProducto($event)" [(ngModel)]="selectedProducto">
                    </ng-select>
                  </div>
                 
                </div>
  
                <div class="form-row">
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip12">Estado de Humedad</label>
                    <ng-select [items]="listaSubProducto" formControlName="subProducto" class="form-control"
                      bindLabel="Label" bindValue="Codigo" id="validationTooltip12" placeholder="Sub Producto"
                      [ngClass]="{ 'is-invalid': submitted && f.subProducto.invalid, 'is-valid': submitted && !f.subProducto.invalid }"
                      [(ngModel)]="selectedSubProducto">
                    </ng-select>
                  </div>
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip32">Motivo</label>
                    <ng-select [items]="listaMotivo" formControlName="motivo" class="form-control" bindLabel="Label"
                      bindValue="Codigo" id="validationTooltip32" placeholder="Motivo"
                      [ngClass]="{ 'is-invalid': submitted && f.motivo.invalid, 'is-valid': submitted && !f.motivo.invalid }"
                      [(ngModel)]="selectedMotivo">
                    </ng-select>
                  </div>
  
                  <div class="col-md-4 mb-4 form-group mb-2">
                    <label for="validationTooltip12">Estado</label>
                    <ng-select [items]="listaEstado" formControlName="estado" class="form-control" bindLabel="Label"
                      bindValue="Codigo" id="validationTooltip12" placeholder="Estado"
                      [ngClass]="{ 'is-invalid': submitted && f.estado.invalid, 'is-valid': submitted && !f.estado.invalid }"
                      [(ngModel)]="selectedEstado">
                    </ng-select>
                  </div>
  
                
  
                
                </div>
                <small class="form-text text-muted danger"
                *ngIf="errorGeneral.isError">{{errorGeneral.errorMessage}}</small>
                <button class="btn btn-primary mr-1 mb-1" type="submit" (click)="buscar()">Buscar</button>
                <button class="btn btn-primary mr-1 mb-1" type="button" data-toggle="tooltip" data-placement="top"
                  (click)="Agregar(selected)" [disabled]="!rows.length || !selected.length"
                  *ngIf="popUp">Seleccionar</button>
                <button class="btn btn-primary mr-1 mb-1" type="button" (click)="nuevo()" *ngIf="!popUp"  [disabled]="readonly==true">Nuevo</button>
                <button class="btn btn-primary mr-1 mb-1" type="button" [disabled]="selected.length==0 || readonly==true" (click)="anular()"
                  *ngIf="!popUp">Anular</button>

                  <button class="btn btn-primary mr-1 mb-1" type="button" [disabled]="selected.length==0 || readonly==true" (click)="Procesar()"
                  *ngIf="!popUp">Procesar</button>

                  <button class="btn btn-primary mr-1 mb-1" type="button" [disabled]="selected.length==0 || readonly==true" (click)="Rechazado()"
                  *ngIf="!popUp">Rechazado</button>
                <!--<button class="btn btn-primary mr-1 mb-1" type="button" [disabled]="selected.length==0 || readonly==true" (click)="enviar()"
                  *ngIf="!popUp">Enviar a Almacen</button>-->

                 <!--<button class="btn btn-primary mr-1 mb-1" type="button" [disabled]="rows.length==0" (click)="exportar()"
                  *ngIf="!popUp">Exportar</button>-->
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  
  <div class="d-flex justify-content-between align-items-center">
    <ngx-spinner></ngx-spinner>
  </div>
  
  <!-- Filter Datatables -->
  <section id="ngx-datatable-filter">
    <div class="row">
      <div class="col-12">
      </div>
      <div class="col-12">
        <div class="card">
          <div class="card-content">
            <div class="card-body">
              <fieldset class="form-group">
                <label>Show
                  <select name="users-list-select"
                    class="form-control form-control-sm d-inline-block width-100 p-right-25 pl-4 mx-1"
                    (click)="updateLimit($event)">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                  entries</label>
                <label for="ngx-filter-ref" class="float-right">Search:
                  <input id="ngx-filter-ref" class="form-control form-control-sm d-inline-block width-200 ml-1"
                    type="text" (keyup)="filterUpdate($event)" />
                </label>
              </fieldset>
              <ngx-datatable class="bootstrap core-bootstrap" [columnMode]="ColumnMode.force" [headerHeight]="50"
                [footerHeight]="50" rowHeight="auto" [limit]="limitRef" [rows]="rows" [scrollbarH]="true" width="100"
                [selectCheck]="singleSelectCheck" [selected]="selected" [selectionType]="'single'">
  
                <ngx-datatable-column name="N° Nota Ingreso" prop="Numero" width="120" *ngIf="!popUp">
  
                  <ng-template let-row="row" let-name="value" ngx-datatable-cell-template>
                    <div class="d-flex align-items-center">
                      <div class="cell-line-height">
                        <a class="line-height-1 mb-0" routerLink="/planta/operaciones/controlcalidad-edit"
                          [queryParams]="{ id: row.ControlCalidadPlantaId, status: row.EstadoId}">{{ name }}</a>
                      </div>
                    </div>
                  </ng-template>
                </ngx-datatable-column>
  
  
                <ngx-datatable-column name="Numero Nota Ingreso" prop="Numero" width="90" *ngIf="popUp">
                </ngx-datatable-column>
                <ngx-datatable-column name="Nro Guia Remisión" prop="NumeroGuiaRemision" width="140">
                </ngx-datatable-column>
                <ngx-datatable-column name="Fecha Guia Remision" prop="FechaGuiaRemision" width="140">
                </ngx-datatable-column>
                <ngx-datatable-column name="Fecha Ingreso" prop="FechaRegistroCadena" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Organizacion" prop="RazonSocial" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Tipo Producto" prop="Producto" width="140">
                </ngx-datatable-column>
                <ngx-datatable-column name="Certificacion" prop="Certificacion" width="140">
                </ngx-datatable-column>
                <ngx-datatable-column name="Estado de Humedad" prop="SubProducto" width="140"></ngx-datatable-column>
                <ngx-datatable-column name="Motivo" prop="MotivoIngreso" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Cantidad Recibida" prop="Cantidad" width="80"></ngx-datatable-column>
                <ngx-datatable-column name="Peso Bruto Kg Recibida" prop="KilosBrutos" width="120"></ngx-datatable-column>
                <ngx-datatable-column name="Kilos Netos Recibidos" prop="KilosNetos" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="% Humedad Recepción" prop="HumedadPorcentaje" width="100"></ngx-datatable-column>
           <!---- ya se agrego campo nuevos a la grilla -->
                <ngx-datatable-column name="Cantidad Procesada" prop="CantidadProcesada" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Kilos Netos Procesado" prop="KilosNetosProcesado" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Cantidad Rechazada" prop="CantidadRechazada" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Kilos Netos Rechazados" prop="KilosNetosRechazados" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Cantidad Disponible " prop="CantidadDisponible" width="100"></ngx-datatable-column>
                <ngx-datatable-column name="Kilos Netos Disponibles" prop="KilosNetosDisponibles" width="100"></ngx-datatable-column>  
             <!-- estos campos no se usaran -->
                <!--<ngx-datatable-column name="% Rendimiento" prop="RendimientoPorcentaje" width="140"></ngx-datatable-column>
                <ngx-datatable-column name="Puntaje Final" prop="PuntajeFinal" width="100"></ngx-datatable-column>-->
                <!-- <ngx-datatable-column name="Certificacion" prop="Certificacion" width="30"></ngx-datatable-column> -->
  
                <ngx-datatable-column name="Estado" prop="Estado" width="150">
                  <ng-template let-status="value" ngx-datatable-cell-template>
                    <div class="badge" [ngClass]="{
                            'bg-light-success': status == 'Pesado',
                            'bg-light-danger': status == 'Anulado',
                            'bg-light-warning': status == 'Analizado'
                          }">
                      {{ status }}
                    </div>
                  </ng-template>
                </ngx-datatable-column>
              </ngx-datatable>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--/ Filter Datatables -->